#!/bin/sh

#========================================================================
# スクリーンショットを取得する
#========================================================================

#========================================================================
# デフォルトサイズおよびスクリーンショットファイル
#========================================================================
width=1200
height=800
outfile=${HOME}/ss.png

#========================================================================
# オプションを処理
#========================================================================
while getopts f:Lw:h: OPT
do
	case $OPT in
	f)
		outfile="$OPTARG"
		;;
	w) 
		width="$OPTARG"
		;;
	h) 
		height="$OPTARG"
		;;
	esac
done
shift $((OPTIND - 1))

#========================================================================
# スクリーンショット取得に利用するアプリケーション
#========================================================================
msedge='/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe'
chrome='/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'

#========================================================================
# どの方法でスクリーンショットを取得するかを判断
#========================================================================
method="none"
case "$(eval echo '$'{$#})" in
http*)
	#================================================================
	# Webページのスクリーンショットを取得する
	#================================================================
	type="web"

	#================================================================
	# Microsoft Edgeを使って取得 (Windows)
	#================================================================
	if [ -e "$msedge" ]
	then
		method="msedge"
	
	#================================================================
	# Google Chromeを使って取得 (Mac)
	#================================================================
	elif [ -e "$chrome" ]
	then
		method="chrome"
	
	fi
	;;
*)
	#================================================================
	# デスクトップのスクリーンショットを取得する
	# XXX OSごとに画面のスクリーンショットを取る処理をそのうち実装
	#================================================================
	type="desktop"
	;;
esac

#========================================================================
# Webページのスクリーンショットを取得
#========================================================================
case "${type}" in
web)
	case "${method}" in
	msedge)
		#================================================================
		# Microsoft Edgeを使って取得 (Windows)
		#================================================================
		"$msedge"	--headless					\
				--virtual-time-budget=10000			\
				--window-size=$width,$height			\
				--screenshot="$outfile"				\
				--hide-scrollbars				\
				${@}
		;;
	chrome)
		#================================================================
		# Google Chromeを使って取得 (Mac)
		#================================================================
		"$chrome"	--headless					\
				--virtual-time-budget=10000			\
				--window-size=$width,$height			\
				--screenshot="$outfile"				\
				--hide-scrollbars				\
				${@}
		;;
	esac
	;;

#========================================================================
# デスクトップのスクリーンショットを取得
#========================================================================
desktop)
	# XXX OSごとに画面のスクリーンショットを取る処理をそのうち実装
	;;
esac
