#!/bin/sh

case "$(uname)" in
FreeBSD)
	# FreeBSD

	# BSDmake
	exec /usr/bin/make "${@}"
	;;
Darwin)
	# Mac
	if [ -n "$(which bsdmake)" ]
	then
		brew install bsdmake
	fi

	case "$(pwd)" in
	${HOME}/Documents/*)
		# BSDmake
		exec $(which bsdmake | head -1) "${@}"
		;;
	*)
		# GNUmake
		exec /usr/bin/make "${@}"
		;;
	esac
	;;
MSYS*)
	# Windows (MSYS2)
	if [ ! -f /usr/bin/make.exe ]
	then
		pacman -S --noconfirm make
	fi

	# GNUmake
	if [ -f Makefile.win ]
	then
		exec -f /usr/bin/make Makefile.win
	else
		exec /usr/bin/make
	fi
	# Windows (MSYS2)
	;;
MINGW*)
	# Windows (MSYS2 MinGW-w64)
	if [ ! -f /mingw64/bin/mingw32-make.exe ]
	then
		pacman -S --noconfirm mingw-w64-x86_64-make

	fi

	# GNUmake
	if [ -f Makefile.win ]
	then
		exec /mingw64/bin/mingw32-make.exe -f Makefile.win
	else
		exec /mingw64/bin/mingw32-make.exe
	fi
	;;
*)
	# others
	if [ -z "$(which make | grep -v ${0} | head -1)" ]
	then
		echo "no such command: make" 1>&2
		exit 1
	else
		exec $(which make | grep -v ${0} | head -1)
	fi
	;;
esac
