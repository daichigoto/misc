#!/bin/sh

#=========================================================================
# 翻訳サービスを使ったテキストの翻訳コマンド
#=========================================================================

#=========================================================================
# コマンドセットをセットアップ
#=========================================================================
case "$(uname)" in
Darwin)
	#=================================================================
	# Apple Silicon Mac
	#=================================================================
	d=~/Library/Python
	if	[ -z $(find "$d" -name deepl -type f 2> /dev/null) ]
	then
		pip3	install deepl-translate
	fi

	pth=$(find "$d" -name deepl -type f 2> /dev/null | head -1)
	PATH="${pth%/*}:${PATH}"
	;;
*)
	#=================================================================
	# Windows MSYS2
	#=================================================================
	if	[ ! -e /usr/bin/pip ]
	then
		pacman -S --noconfirm python-pip
	fi
	
	if	[ ! -e /usr/bin/deepl ]
	then
		pip install deepl-translate
	fi
	;;
esac

#=========================================================================
# 指定されたファイルまたはパイプラインから受けとるテキストデータを翻訳
# サービスを使って翻訳
#=========================================================================
# 翻訳対象のデータを一時ファイルに保存
tmp=/tmp/$$
if	[ 0 = $# ]
then
	cat	> $tmp-src
else
	cat	$1 > $tmp-src
fi

# 翻訳サービスで翻訳
if	[ -s $tmp-src ]
then
	deepl	English Japanese --file $tmp-src
fi

# 一時ファイルを削除
rm	-f $tmp-*
