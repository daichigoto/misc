#!/bin/sh

#========================================================================
# TSVデータから円グラフ画像を作成する
#========================================================================

#========================================================================
# Google Charts APIの基本URL
#========================================================================
chart='https://chart.apis.google.com/chart'

#========================================================================
# グラフ種類
#========================================================================
type='cht=p'

#========================================================================
# グラフサイズ
#========================================================================
# 2023/02/08時点で、一辺1000まで、ピクセル合計300,000までの制限
size='chs=600x400'

#========================================================================
# グラフデータ
#========================================================================
# 1列目: ラベル
#   chl=ラベル1|ラベル2|ラベル3|...|ラベルN
#       空白は「+」で表現
label="chl=$(
cat	$1								|
tsv2ssv									|
retusel	1								|
sed	's/$/|/'							|
tr	-d '\n'								|
sed	's/|$//'							|
sed	's/_/+/g'							)"

# 2列目: データ
#   chd=t:値1,値2,値3,...,値N
data="chd=t:$(
cat	$1								|
tsv2ssv									|
retusel	2								|
sed	's/$/,/'							|
tr	-d '\n'								|
sed	's/,$//'							)"

#========================================================================
# グラフデータを生成
#========================================================================
api="${chart}?${type}&${size}&${label}&${data}"

echo	"${api}"

curl	"${api}"							> chart.png
